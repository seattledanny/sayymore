<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove AmItheDevil Posts</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #c82333; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .log {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóëÔ∏è Remove AmItheDevil Posts</h1>
        <p>This tool will remove all AmItheDevil posts from the Firestore database.</p>
        
        <div class="status warning">
            <strong>‚ö†Ô∏è Warning:</strong> This action cannot be undone. Make sure you want to proceed.
        </div>

        <button id="searchBtn" onclick="searchPosts()">üîç Search AmItheDevil Posts</button>
        <button id="removeBtn" onclick="removePosts()" disabled>üóëÔ∏è Remove All AmItheDevil Posts</button>
        
        <div id="log" class="log"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
        import { getFirestore, collection, query, where, getDocs, deleteDoc, doc, writeBatch } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHSs1mM52_fSSRqHUgMhjUnRuC6B_2bRU",
            authDomain: "reddit-conversations-af4ed.firebaseapp.com",
            projectId: "reddit-conversations-af4ed",
            storageBucket: "reddit-conversations-af4ed.firebasestorage.app",
            messagingSenderId: "1098498238947",
            appId: "1:1098498238947:web:b5e9bf3f39dca9bfadbdcd"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let foundPosts = [];

        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        window.searchPosts = async function() {
            const searchBtn = document.getElementById('searchBtn');
            const removeBtn = document.getElementById('removeBtn');
            
            searchBtn.disabled = true;
            removeBtn.disabled = true;
            foundPosts = [];
            
            try {
                log('üîç Searching for AmItheDevil posts...');
                
                const q = query(
                    collection(db, 'posts'),
                    where('subreddit', '==', 'AmItheDevil')
                );
                
                const querySnapshot = await getDocs(q);
                foundPosts = querySnapshot.docs;
                
                log(`üìä Found ${foundPosts.length} AmItheDevil posts`);
                
                if (foundPosts.length === 0) {
                    log('‚úÖ No AmItheDevil posts found. Nothing to remove.');
                    document.querySelector('.container').innerHTML += 
                        '<div class="status success"><strong>‚úÖ Success:</strong> No AmItheDevil posts found in the database.</div>';
                } else {
                    log('‚ö†Ô∏è Ready to remove posts. Click "Remove All AmItheDevil Posts" to proceed.');
                    removeBtn.disabled = false;
                    
                    // Show sample posts
                    log('\nüìù Sample posts to be removed:');
                    foundPosts.slice(0, 5).forEach((docSnapshot, i) => {
                        const data = docSnapshot.data();
                        log(`   ${i+1}. ${data.title?.substring(0, 60)}... (Score: ${data.score})`);
                    });
                    if (foundPosts.length > 5) {
                        log(`   ... and ${foundPosts.length - 5} more posts`);
                    }
                }
                
            } catch (error) {
                log('‚ùå Error searching posts: ' + error.message);
                document.querySelector('.container').innerHTML += 
                    '<div class="status error"><strong>‚ùå Error:</strong> ' + error.message + '</div>';
            } finally {
                searchBtn.disabled = false;
            }
        };

        window.removePosts = async function() {
            if (foundPosts.length === 0) return;
            
            const removeBtn = document.getElementById('removeBtn');
            removeBtn.disabled = true;
            
            try {
                log(`üóëÔ∏è Starting removal of ${foundPosts.length} posts...`);
                
                // Batch delete posts (Firestore allows max 500 per batch)
                const batches = [];
                let currentBatch = writeBatch(db);
                let operationCount = 0;
                
                foundPosts.forEach((docSnapshot) => {
                    currentBatch.delete(doc(db, 'posts', docSnapshot.id));
                    operationCount++;
                    
                    // If we reach 500 operations, start a new batch
                    if (operationCount === 500) {
                        batches.push(currentBatch);
                        currentBatch = writeBatch(db);
                        operationCount = 0;
                    }
                });
                
                // Add the last batch if it has operations
                if (operationCount > 0) {
                    batches.push(currentBatch);
                }
                
                log(`üì¶ Processing ${batches.length} batch(es)...`);
                
                // Execute all batches
                for (let i = 0; i < batches.length; i++) {
                    log(`   Batch ${i + 1}/${batches.length}...`);
                    await batches[i].commit();
                }
                
                log('‚úÖ Successfully removed all AmItheDevil posts!');
                document.querySelector('.container').innerHTML += 
                    '<div class="status success"><strong>‚úÖ Success:</strong> All AmItheDevil posts have been removed from the database.</div>';
                    
                foundPosts = [];
                
            } catch (error) {
                log('‚ùå Error removing posts: ' + error.message);
                document.querySelector('.container').innerHTML += 
                    '<div class="status error"><strong>‚ùå Error:</strong> ' + error.message + '</div>';
            }
        };

        // Auto-search on page load
        window.addEventListener('load', () => {
            log('üöÄ Page loaded. Firebase initialized.');
            setTimeout(searchPosts, 1000);
        });
    </script>
</body>
</html> 